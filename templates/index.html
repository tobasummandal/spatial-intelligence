<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spatial Intelligence - Claude JSON Generator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ§  Spatial Intelligence</h1>
            <p>Generate Structured JSON from 3D Renderings</p>
        </header>

        <div class="main-content">
            <!-- Configuration Panel -->
            <div class="panel config-panel">
                <h2>Upload 3D File</h2>
                
                <div class="upload-section">
                    <div class="file-drop-zone" id="file-drop-zone">
                        <div class="upload-icon">ðŸ“¦</div>
                        <p>Drag & drop your 3D file here</p>
                        <p class="upload-hint">or click to browse</p>
                        <p class="file-formats">Supported: .obj, .glb, .gltf, .fbx, .stl, .ply, .dae, .blend, .3ds, .x3d</p>
                        <input type="file" id="file-input" accept=".obj,.glb,.gltf,.fbx,.stl,.ply,.dae,.blend,.3ds,.x3d" style="display: none;">
                    </div>
                    <div id="file-info" class="file-info" style="display:none;">
                        <p><strong>Selected file:</strong> <span id="file-name"></span></p>
                        <p><strong>Size:</strong> <span id="file-size"></span></p>
                        <button class="btn-secondary btn-small" onclick="clearFile()">âœ• Clear</button>
                    </div>
                </div>

                <div class="workflow-toggle">
                    <label>
                        <input type="radio" name="workflow_type" value="upload" checked>
                        Upload & Process 3D File
                    </label>
                    <label>
                        <input type="radio" name="workflow_type" value="existing">
                        Process Existing Renders
                    </label>
                </div>

                <h2>Configuration</h2>
                
                <div class="form-group">
                    <label for="api_key">Claude API Key *</label>
                    <input type="password" id="api_key" placeholder="sk-ant-api03-...">
                </div>

                <div class="form-group">
                    <label for="parent_dir">Parent Directory</label>
                    <input type="text" id="parent_dir" value="./example_material" placeholder="./example_material">
                </div>

                <div class="form-group">
                    <label for="model">Model</label>
                    <select id="model">
                        <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                        <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                        <option value="claude-3-sonnet-20240229">Claude 3 Sonnet</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="num_views">Number of Views</label>
                        <input type="number" id="num_views" value="6" min="1" max="28">
                    </div>

                    <div class="form-group">
                        <label for="max_tokens">Max Tokens</label>
                        <input type="number" id="max_tokens" value="4096" min="512" max="8192">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="rate_limit_delay">Rate Limit Delay (s)</label>
                        <input type="number" id="rate_limit_delay" value="1.0" min="0" max="10" step="0.1">
                    </div>
                </div>

                <div class="form-group checkbox-group">
                    <label>
                        <input type="checkbox" id="use_diffurank" checked>
                        Use DiffuRank Scores
                    </label>
                    <label>
                        <input type="checkbox" id="overwrite">
                        Overwrite Existing Outputs
                    </label>
                </div>

                <h3>JSON Template</h3>
                <div class="template-selector">
                    <label>
                        <input type="radio" name="template_type" value="file" checked>
                        Use Template File
                    </label>
                    <label>
                        <input type="radio" name="template_type" value="inline">
                        Inline JSON
                    </label>
                </div>

                <div id="template-file-section" class="template-section">
                    <select id="template_file">
                        <option value="">Loading templates...</option>
                    </select>
                    <button class="btn-secondary" onclick="loadTemplatePreview()">Preview</button>
                </div>

                <div id="template-inline-section" class="template-section" style="display:none;">
                    <textarea id="inline_template" rows="12" placeholder='{"field": "value", ...}'></textarea>
                </div>

                <div id="template-preview" class="template-preview" style="display:none;">
                    <h4>Template Preview</h4>
                    <pre id="template-preview-content"></pre>
                </div>

                <div class="action-buttons">
                    <button class="btn-primary" onclick="startProcessing()" id="run-btn">
                        â–¶ Start Processing
                    </button>
                    <button class="btn-danger" onclick="stopScript()" id="stop-btn" style="display:none;">
                        â¬› Stop
                    </button>
                </div>
            </div>

            <!-- Preview & Results Panel -->
            <div class="panel results-panel">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('folders')">Folders</button>
                    <button class="tab" onclick="switchTab('progress')">Progress</button>
                    <button class="tab" onclick="switchTab('viewer')">Results Viewer</button>
                </div>

                <!-- Folders Tab -->
                <div id="folders-tab" class="tab-content active">
                    <button class="btn-secondary" onclick="loadFolders()">ðŸ”„ Refresh Folders</button>
                    <div id="folders-list" class="folders-list">
                        <p class="placeholder">Click "Refresh Folders" to load available folders</p>
                    </div>
                </div>

                <!-- Progress Tab -->
                <div id="progress-tab" class="tab-content">
                    <div id="progress-output" class="progress-output">
                        <p class="placeholder">Progress will appear here when script is running</p>
                    </div>
                </div>

                <!-- Results Viewer Tab -->
                <div id="viewer-tab" class="tab-content">
                    <p class="placeholder">Select a processed folder from the Folders tab to view results</p>
                    <div id="results-viewer" style="display:none;">
                        <h3>Images</h3>
                        <div id="images-grid" class="images-grid"></div>
                        
                        <h3>Generated JSON Output</h3>
                        <pre id="json-output" class="json-output"></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>

